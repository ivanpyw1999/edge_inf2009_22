{% extends 'dashboard_ui.html' %}
{% block dashboard_content %}

<div class="container mx-auto px-4">
    <!-- First Row: 2 Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 md:gap-6">
        <!-- Items Chart (2/3 width on medium screens, full-width on small screens) -->
        <div class="relative flex items-center h-full w-full py-6 md:col-span-2">
            <div class="relative flex flex-col justify-between h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto">
                <h2 class="text-lg font-semibold mb-4">Items Shown</h2>
                <canvas id="itemsChart"></canvas>
            </div>
        </div>

        <!-- Top 5 Items Chart -->
        <div class="relative flex items-center h-full w-full md:p-6">
            <div class="relative flex flex-col justify-center h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto text-center">
                <h2 class="text-lg font-semibold mb-4">Top 5 Items</h2>
                <canvas id="topItemsChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Second Row: 3 Cards (Equal Height Cards) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-6">
        <!-- Most Popular Item -->
        <div class="relative flex items-center h-full w-full md:p-6">
            <div class="relative flex flex-col justify-center h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto text-center">
                <h2 class="text-lg font-semibold mb-2">Most Popular Item</h2>
                <p id="mostPopular" class="text-2xl font-bold text-green-600">
                    {% if popular %}
                      {{ popular.name }} ({{ popular.counter }})
                    {% else %}
                      N/A
                    {% endif %}
                </p>
            </div>
        </div>

        <!-- Least Popular Item -->
        <div class="relative flex items-center h-full w-full md:p-6">
            <div class="relative flex flex-col justify-center h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto text-center">
                <h2 class="text-lg font-semibold mb-2">Least Popular Item</h2>
                <p id="leastPopular" class="text-2xl font-bold text-red-600">
                    {% if least %}
                      {{ least.name }} ({{ least.counter }})
                    {% else %}
                      N/A
                    {% endif %}
                </p>
            </div>
        </div>

        <!-- Advertisement Traffic -->
        <div class="relative flex items-center h-full w-full md:p-6 pb-6">
            <div class="relative flex flex-col justify-center h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto text-center">
                <h2 class="text-lg font-semibold mb-2">Advertisement Traffic</h2>
                <p id="trafficCount" class="text-4xl font-bold text-blue-600">{{ total_ads }}</p>
            </div>
        </div>
    </div>

    <!-- List of Products (Test Only) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
        {% for product in products %}
        <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col items-center p-6 text-center transition-transform hover:scale-105">
            <!-- Image Placeholder (Optional) -->
            <div class="w-24 h-24 bg-gray-200 rounded-full mb-4 flex items-center justify-center">
                <span class="text-gray-400 text-sm">Image</span>
            </div>
    
            <!-- Product Info -->
            <h3 class="text-xl font-semibold text-gray-800">{{ product.name }}</h3>
            <p class="text-sm text-gray-500 mb-2">{{ product.category }}</p>
    
            <!-- Example Button -->
            <button class="mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">View Details</button>
        </div>
        {% endfor %}
    </div>
    
</div>

<!-- Include Chart.js and the datalabels plugin -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // (Optional) Items Chart - you can either populate this dynamically or leave it as sample data.
    const itemData = [12, 19, 25, 32, 18, 21, 40];
    const days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
    const ctx = document.getElementById("itemsChart").getContext("2d");

    new Chart(ctx, {
        type: "bar",
        data: {
            labels: days,
            datasets: [{
                label: "Items Shown",
                data: itemData,
                backgroundColor: "rgba(75, 192, 192, 0.5)",
                borderColor: "rgba(75, 192, 192, 1)",
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: { y: { beginAtZero: true } },
            plugins: {
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: (value) => value
                }
            }
        }
    });

    // Pass top_ads from Flask to JavaScript for the Top 5 Items pie chart.
    const topAds = {{ top_ads | tojson }};
    const topAdsLabels = topAds.map(ad => ad.name);
    const topAdsData = topAds.map(ad => ad.counter);

    const pieCtx = document.getElementById("topItemsChart").getContext("2d");
    new Chart(pieCtx, {
        type: "pie",
        data: {
            labels: topAdsLabels,
            datasets: [{
                data: topAdsData,
                backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF"],
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: "bottom" },
                datalabels: {
                    formatter: (value, ctx) => ctx.chart.data.labels[ctx.dataIndex],
                    color: "#fff",
                    font: { weight: "bold" }
                }
            }
        }
    });
});
</script>

{% endblock %}
