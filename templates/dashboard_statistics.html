{% extends 'dashboard_ui.html' %}
{% block dashboard_content %}

<div class="container mx-auto px-4">
    <!-- First Row: 2 Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 md:gap-6">
        <!-- Items Chart (2/3 width on medium screens, full-width on small screens) -->
        <div class="relative flex items-center h-full w-full py-6 md:col-span-2">
            <div class="relative flex flex-col justify-between h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto">
                <h2 class="text-lg font-semibold mb-4">Items Shown</h2>
                <canvas id="itemsChart"></canvas>
            </div>
        </div>

        <!-- Website Traffic (1/3 width on medium screens, full-width on small screens) -->
        <div class="relative flex items-center h-full w-full md:p-6">
            <div class="relative flex flex-col justify-center h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto text-center">
                <h2 class="text-lg font-semibold mb-4">Top 5 Items</h2>
                <canvas id="topItemsChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Second Row: 3 Cards (Equal Height Cards) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-6">
        <!-- Most Popular Item -->
        <div class="relative flex items-center h-full w-full md:p-6">
            <div class="relative flex flex-col justify-center h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto text-center">
                <h2 class="text-lg font-semibold mb-2">Most Popular Item</h2>
                <p id="mostPopular" class="text-2xl font-bold text-green-600"></p>
            </div>
        </div>

        <!-- Least Popular Item -->
        <div class="relative flex items-center h-full w-full md:p-6">
            <div class="relative flex flex-col justify-center h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto text-center">
                <h2 class="text-lg font-semibold mb-2">Least Popular Item</h2>
                <p id="leastPopular" class="text-2xl font-bold text-red-600"></p>
            </div>
        </div>

        <!-- Website Traffic -->
        <div class="relative flex items-center h-full w-full md:p-6 pb-6">
            <div class="relative flex flex-col justify-center h-full rounded-lg bg-white shadow-lg p-6 w-full mx-auto text-center">
                <h2 class="text-lg font-semibold mb-2">Advertisement Traffic</h2>
                <p id="trafficCount" class="text-4xl font-bold text-blue-600"></p>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Sample data for Items Chart
        const itemData = [12, 19, 25, 32, 18, 21, 40];
        const days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
        const ctx = document.getElementById("itemsChart").getContext("2d");

        new Chart(ctx, {
            type: "bar",
            data: {
                labels: days,
                datasets: [{
                    label: "Items Shown",
                    data: itemData,
                    backgroundColor: "rgba(75, 192, 192, 0.5)",
                    borderColor: "rgba(75, 192, 192, 1)",
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true } },
                plugins: {
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        formatter: (value) => value
                    }
                }
            }
        });

        // Website Traffic - Formatting large numbers
        const websiteTraffic = 1234567;
        document.getElementById("trafficCount").textContent = websiteTraffic.toLocaleString();

        // Sample data for Most & Least Popular Item
        const itemsPopularity = {
            "Item A": 450,
            "Item B": 120,
            "Item C": 380,
            "Item D": 290,
            "Item E": 90
        };

        const sortedItems = Object.entries(itemsPopularity).sort((a, b) => b[1] - a[1]);
        document.getElementById("mostPopular").textContent = sortedItems[0][0] + " (" + sortedItems[0][1] + ")";
        document.getElementById("leastPopular").textContent = sortedItems[sortedItems.length - 1][0] + " (" + sortedItems[sortedItems.length - 1][1] + ")";

        // Pie Chart for Top 5 Items
        const pieCtx = document.getElementById("topItemsChart").getContext("2d");
        new Chart(pieCtx, {
            type: "pie",
            data: {
                labels: sortedItems.map(item => item[0]),
                datasets: [{
                    data: sortedItems.map(item => item[1]),
                    backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF"],
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: "bottom" },
                    datalabels: {
                        formatter: (value, ctx) => ctx.chart.data.labels[ctx.dataIndex],
                        color: "#fff",
                        font: { weight: "bold" }
                    }
                }
            }
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

{% endblock %}
